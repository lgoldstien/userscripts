<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>// ==UserScript==
// @name                The Web Clipboard
// @description         This script will give you a clipboard on every webpage you visit
// @version             0.1
// @namespace           http://lgoldstien.github.io/userscripts
// @downloadURL         https://raw.github.com/lgoldstien/userscripts/stable/in_browser_clipboard/web_clipboard.user.js
// @updateURL           https://raw.github.com/lgoldstien/userscripts/stable/in_browser_clipboard/web_clipboard.user.js
// @require             http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js
// @grant               GM_setClipboard
// @grant               GM_addStyle
// ==/UserScript==

// The clipboard functions
var clipboard = {

    setClipboard: function (text) {
        
        GM_setClipboard(text);

    },

    getClipboard: function (e) {
        if (e.ctrlKey && e.keyCode === 67) {
            var content = window.getSelection();
            this.storeItem(content);
        }
    },

    storeItem: function (content) {
        var row = parseInt(this.storageCurrentRows());
        localStorage.setItem("web_clipboard_" + row, content);
        localStorage.setItem("web_clipboard_rows", row);
        console.log("Copied an item to storage row " + row + " with following content: " + content)
    },

    storageCountRows: function () {
        if ( localStorage.getItem("web_clipboard_rows") == null ){
            return 0;
        }
        if ( isNaN( localStorage.getItem("web_clipboard_rows") ) ) {
            return 0;
        } else {
            return localStorage.getItem("web_clipboard_rows");
        }
        
    },

    storageCurrentRows: function () {
        return parseInt(this.storageCountRows()) + 1;
    },

    storageClear: function () {

    },

    createContainerDiv: function () {
        // Add the div to contain the clipboard
        var web_clipboard = document.createElement('div');
        web_clipboard.id = "web_clipboard";
        web_clipboard.innerHTML = ""
        document.getElementsByTagName('body')[0].appendChild(web_clipboard);
    },

    containerStyle: "#web_clipboard { background-color: #eee; position: fixed; top: 0; right: 15px; width: 30px; height: 25px; border-radius: 0 0 10px 10px; z-index: 99999; box-shadow: 0px 1px 3px black;}",


}

// The localstorage variables
var storage = {

    // Do we support HTML5 Storage?
    supported: function () {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },
    getItem: function (key) {
        if ( this.supported() == false ) {
            console.log("Storage not supported.");
        } else {
            return localStorage[key];
        }
    },
    setItem: function (key, data) {
        if ( this.supported() == false ) {
            console.log("Storage not supported.");
        } else {
            localStorage[key] = data;
        }
    },
    getArray: function (key) {
        var item = this.getItem(key);
        return JSON.parse(item);
    },
    setArray: function (key, data) {
        var string = JSON.stringify(data);
        
    },
    getAll: function () {
        return localStorage;
    },
    deleteAll: function () {
        localStorage.clear();
    }

}

function testJSON () {
    var array = ["text bit 1", "text bit 2", "text bit 3", "text bit 4"];
    return JSON.stringify(array);
}
// Initialise the objects and get ready
$(document).ready(function(){
    
    // Add the div to the page
    clipboard.createContainerDiv();
    console.log("Created <div>");

    // Add the style to the page
    //GM_addStyle(clipboard.containerStyle);
    console.log("Styled <div>");

    // Add the keyboard hook
    $(window).keydown(function (e) {
        clipboard.getClipboard(e);
    });

});
</script>
<style>
#web_clipboard {
    background-color: #eee; 
    position: fixed; 
    top: 0; 
    right: 15px; 
    width: 30px; 
    height: 20px; 
    border-radius: 0 0 10px 10px; 
    z-index: 99999; 
    box-shadow: 0px 1px 3px black;
}
</style>
<body>
Some text to copy.
<textarea>Some space to paste</textarea>
<div id="the_board"></div>
</body>
